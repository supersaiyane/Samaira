ðŸ“˜ Database Schema
==================

1\. Overview
------------

The FinOps platform uses **PostgreSQL** as its primary data store.Weâ€™ve designed the schema to capture **cloud resources, billing, usage, anomalies, recommendations, savings, forecasts, and insights**, all tied together with relationships.

2\. Entity Relationship Diagram (ERD)
-------------------------------------

```mermaid
erDiagram
    Account ||--o{ Resource : owns
    Account ||--o{ Cluster : manages
    Account ||--o{ Billing : billed
    Account ||--o{ Anomaly : flagged
    Account ||--o{ Forecast : forecasted
    Account ||--o{ Saving : validates


    ServiceCategory ||--o{ Service : contains
    Service ||--o{ Resource : provisioned
    Service ||--o{ Billing : charges
    Service ||--o{ Usage : metrics
    Service ||--o{ Anomaly : anomalies
    Service ||--o{ Forecast : forecasts


    Resource ||--o{ Usage : measured
    Resource ||--o{ Billing : costs
    Resource ||--o{ Recommendation : rightsized
    Resource ||--o{ Saving : savings


    Cluster ||--o{ ClusterResource : links
    ClusterResource }o--|| Resource : contains


    Recommendation ||--o{ Saving : validates


    Forecast ||--o{ Insight : informs
    Anomaly ||--o{ Insight : informs


    InstanceCatalog ||--o{ Recommendation : supports
    Budget ||--o{ Anomaly : breaches


    Log ||--o{ Account : context
    UnmappedService ||--o{ Service : backlog


    AIQueryLog ||--o{ Insight : queries

```

3\. Tables & Fields
-------------------

### **Accounts**

*   account\_id (PK)
    
*   cloud\_provider (AWS/GCP/Azure)
    
*   account\_number, account\_name
    
*   owner\_email
    
*   created\_at
    

ðŸ‘‰ Represents a single cloud account/subscription.

### **Service Categories**

*   category\_id (PK)
    
*   category\_name (Compute, Storage, Networkingâ€¦)
    
*   description
    

ðŸ‘‰ Logical grouping of services.

### **Services**

*   service\_id (PK)
    
*   cloud\_provider, service\_code, service\_name
    
*   category\_id (FK â†’ ServiceCategory)
    

ðŸ‘‰ Example: AmazonEC2, AmazonS3.

### **Resources**

*   resource\_id (PK)
    
*   account\_id (FK â†’ Account)
    
*   service\_id (FK â†’ Service)
    
*   resource\_name, resource\_type, region
    
*   tags (JSON)
    
*   created\_at, terminated\_at
    

ðŸ‘‰ Represents provisioned units like EC2 instance, S3 bucket.

### **Billing**

*   billing\_id (PK)
    
*   account\_id, service\_id, resource\_id
    
*   usage\_date
    
*   cost\_amount, currency
    
*   usage\_type, usage\_quantity, pricing\_unit
    
*   metadata (JSON)
    

ðŸ‘‰ Daily cloud bill entries.

### **Usage**

*   usage\_id (PK)
    
*   resource\_id
    
*   metric\_name (CPUUtilization, Memory, Invocationsâ€¦)
    
*   metric\_value, unit
    
*   collected\_at, created\_at
    

ðŸ‘‰ Observability data for resources.

### **Clusters & ClusterResources**

*   cluster\_id (PK), account\_id, cluster\_name, cluster\_type, region
    
*   cluster\_resources (junction table: cluster\_id + resource\_id)
    

ðŸ‘‰ Groups resources under clusters (EKS, AKS, GKE).

### **Recommendations**

*   rec\_id (PK)
    
*   resource\_id
    
*   rec\_type (Idle, Rightsize)
    
*   current\_config, recommended\_config (JSON)
    
*   estimated\_savings, currency
    
*   created\_at, status (pending/applied/validated)
    

ðŸ‘‰ Generated by rightsizing DAG.

### **Anomalies**

*   anomaly\_id (PK)
    
*   account\_id, service\_id
    
*   metric, observed\_value, expected\_value, deviation\_percent
    
*   detected\_at, details (JSON)
    

ðŸ‘‰ Cost/usage anomalies detected.

### **Savings**

*   saving\_id (PK)
    
*   account\_id, resource\_id, rec\_id
    
*   implemented\_at, actual\_savings, currency
    

ðŸ‘‰ Validates whether applied recommendations â†’ real savings.

### **Forecasts**

*   forecast\_id (PK)
    
*   account\_id, service\_id
    
*   forecast\_period\_start, forecast\_period\_end
    
*   forecast\_amount, currency
    
*   model\_used, confidence\_interval (JSON)
    
*   generated\_at
    

ðŸ‘‰ Cost prediction for 30/90/180 days.

### **Insights**

*   insight\_id (PK)
    
*   account\_id, service\_id
    
*   insight\_type (trend, anomaly, savings, forecast\_gap)
    
*   severity, message, metadata (JSON)
    
*   created\_at
    

ðŸ‘‰ Powers dashboards.

### **Instance Catalog**

*   id (PK)
    
*   family, size, vcpu, memory, storage, network\_performance, generation, pricing
    
*   last\_updated
    

ðŸ‘‰ Synced weekly via AWS Pricing API.

### **Budgets**

*   budget\_id (PK)
    
*   account\_id, service\_id
    
*   budget\_name, budget\_limit, currency
    
*   created\_at
    

ðŸ‘‰ Budget definitions; breaches â†’ anomalies.

### **Logs**

*   log\_id (PK)
    
*   timestamp, level, component, message
    
*   correlation\_id, user\_id, extra (JSON)
    

ðŸ‘‰ For observability and debugging.

### **Unmapped Services**

*   id (PK)
    
*   cloud\_provider, service\_name, first\_seen, last\_seen
    

ðŸ‘‰ Tracks services not yet mapped into services.

### **AI Queries Log**

*   log\_id (PK)
    
*   query\_text
    
*   created\_at
    
*   status (supported / unsupported)
    

ðŸ‘‰ Tracks AI Assistant queries.

4\. Data Lifecycle Example
--------------------------

**Example: EC2 Rightsizing**

1.  Usage data (CPUUtilization) stored in usage.
    
2.  Rightsizing DAG analyzes usage â†’ recommendation saved in recommendations.
    
3.  If applied, tracked by savings.
    
4.  Insights updated in insights.
    
5.  Dashboards show savings + utilization trends.
    

5\. Knowledge Check (Questions)
-------------------------------

1.  Which tables directly feed **anomaly detection**?
    
2.  Whatâ€™s the role of **InstanceCatalog** in rightsizing?
    
3.  How does **Savings** validate recommendations?
    
4.  Which table logs **AI assistant queries**?
    
5.  Whatâ€™s the relationship between **Billing** and **Usage**?