<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="735px" preserveAspectRatio="none" style="width:875px;height:735px;background:#FFFFFF;" version="1.1" viewBox="0 0 875 735" width="875px" zoomAndPan="magnify"><title>Samaira AI Query Flow (YAML + LLM Fallback)</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="364.998" x="256.0793" y="27.9951">Samaira AI Query Flow (YAML + LLM Fallback)</text><rect fill="none" height="444.2734" style="stroke:#000000;stroke-width:1.5;" width="639.2017" x="228.9551" y="193.8594"/><rect fill="none" height="310.9375" style="stroke:#000000;stroke-width:1.5;" width="619.2017" x="238.9551" y="320.1953"/><rect fill="none" height="177.6016" style="stroke:#000000;stroke-width:1.5;" width="501.7349" x="248.9551" y="373.4609"/><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="536.5391" width="8" x="19.9551" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="23" x2="23" y1="118.5938" y2="655.1328"/></g><g><title>API</title><rect fill="#000000" fill-opacity="0.00000" height="536.5391" width="8" x="273.0293" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="276.9551" x2="276.9551" y1="118.5938" y2="655.1328"/></g><g><title>Service</title><rect fill="#000000" fill-opacity="0.00000" height="536.5391" width="8" x="514.4302" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="517.5596" x2="517.5596" y1="118.5938" y2="655.1328"/></g><g><title>DB</title><rect fill="#000000" fill-opacity="0.00000" height="536.5391" width="8" x="670.2456" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="674.0532" x2="674.0532" y1="118.5938" y2="655.1328"/></g><g><title>Log</title><rect fill="#000000" fill-opacity="0.00000" height="536.5391" width="8" x="717.064" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="720.438" x2="720.438" y1="118.5938" y2="655.1328"/></g><g><title>LLMAdapter</title><rect fill="#000000" fill-opacity="0.00000" height="536.5391" width="8" x="795.4233" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="798.6899" x2="798.6899" y1="118.5938" y2="655.1328"/></g><g class="participant participant-head" data-participant="U"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="5" y="115.292">User</text><ellipse cx="23.9551" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.9551,58.7969 L23.9551,85.7969 M10.9551,66.7969 L36.9551,66.7969 M23.9551,85.7969 L10.9551,100.7969 M23.9551,85.7969 L36.9551,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="U"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31.9102" x="5" y="667.1279">User</text><ellipse cx="23.9551" cy="678.9297" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M23.9551,686.9297 L23.9551,713.9297 M10.9551,694.9297 L36.9551,694.9297 M23.9551,713.9297 L10.9551,728.9297 M23.9551,713.9297 L36.9551,728.9297" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="API"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="36.1484" x="258.9551" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22.1484" x="265.9551" y="107.292">API</text></g><g class="participant participant-tail" data-participant="API"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="36.1484" x="258.9551" y="654.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22.1484" x="265.9551" y="674.1279">API</text></g><g class="participant participant-head" data-participant="Service"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65.7412" x="485.5596" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51.7412" x="492.5596" y="107.292">Service</text></g><g class="participant participant-tail" data-participant="Service"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65.7412" x="485.5596" y="654.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51.7412" x="492.5596" y="674.1279">Service</text></g><g class="participant participant-head" data-participant="DB"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.3848" x="657.0532" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="20.3848" x="664.0532" y="107.292">DB</text></g><g class="participant participant-tail" data-participant="DB"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="34.3848" x="657.0532" y="654.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="20.3848" x="664.0532" y="674.1279">DB</text></g><g class="participant participant-head" data-participant="Log"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="39.252" x="701.438" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25.252" x="708.438" y="107.292">Log</text></g><g class="participant participant-tail" data-participant="Log"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="39.252" x="701.438" y="654.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="25.252" x="708.438" y="674.1279">Log</text></g><g class="participant participant-head" data-participant="LLMAdapter"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97.4668" x="750.6899" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.4668" x="757.6899" y="107.292">LLMAdapter</text></g><g class="participant participant-tail" data-participant="LLMAdapter"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97.4668" x="750.6899" y="654.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83.4668" x="757.6899" y="674.1279">LLMAdapter</text></g><g class="message" data-participant-1="U" data-participant-2="API"><polygon fill="#181818" points="265.0293,145.7266,275.0293,149.7266,265.0293,153.7266,269.0293,149.7266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="23.9551" x2="271.0293" y1="149.7266" y2="149.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229.0742" x="30.9551" y="144.6606">/api/v1/ai/query?q="user question"</text></g><g class="message" data-participant-1="API" data-participant-2="Service"><polygon fill="#181818" points="506.4302,174.8594,516.4302,178.8594,506.4302,182.8594,510.4302,178.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="277.0293" x2="512.4302" y1="178.8594" y2="178.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.291" x="284.0293" y="173.7935">process_query(nl_query)</text></g><path d="M228.9551,193.8594 L293.3979,193.8594 L293.3979,200.9922 L283.3979,210.9922 L228.9551,210.9922 L228.9551,193.8594" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="444.2734" style="stroke:#000000;stroke-width:1.5;" width="639.2017" x="228.9551" y="193.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="243.9551" y="206.9263">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="164.3608" x="308.3979" y="206.0698">[Match in ai_queries.yaml]</text><g class="message" data-participant-1="Service" data-participant-2="DB"><polygon fill="#181818" points="662.2456,228.125,672.2456,232.125,662.2456,236.125,666.2456,232.125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="518.4302" x2="668.2456" y1="232.125" y2="232.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.8154" x="525.4302" y="227.0591">Execute SQL (YAML)</text></g><g class="message" data-participant-1="Service" data-participant-2="Log"><polygon fill="#181818" points="709.064,257.2578,719.064,261.2578,709.064,265.2578,713.064,261.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="518.4302" x2="715.064" y1="261.2578" y2="261.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.7324" x="525.4302" y="256.1919">status="yaml"</text></g><g class="message" data-participant-1="Service" data-participant-2="API"><polygon fill="#181818" points="288.0293,286.3906,278.0293,290.3906,288.0293,294.3906,284.0293,290.3906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="282.0293" x2="517.4302" y1="290.3906" y2="290.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217.4009" x="294.0293" y="285.3247">Return results (summary + rows)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="228.9551" x2="868.1567" y1="299.3906" y2="299.3906"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="107.4058" x="233.9551" y="309.6011">[No YAML match]</text><path d="M238.9551,320.1953 L303.3979,320.1953 L303.3979,327.3281 L293.3979,337.3281 L238.9551,337.3281 L238.9551,320.1953" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="310.9375" style="stroke:#000000;stroke-width:1.5;" width="619.2017" x="238.9551" y="320.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="253.9551" y="333.2622">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="169.1196" x="318.3979" y="332.4058">[USE_LLM_FALLBACK=true]</text><g class="message" data-participant-1="Service" data-participant-2="LLMAdapter"><polygon fill="#181818" points="787.4233,354.4609,797.4233,358.4609,787.4233,362.4609,791.4233,358.4609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="518.4302" x2="793.4233" y1="358.4609" y2="358.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.1045" x="525.4302" y="353.395">generate_sql(nl_query, schema)</text></g><path d="M248.9551,373.4609 L313.3979,373.4609 L313.3979,380.5938 L303.3979,390.5938 L248.9551,390.5938 L248.9551,373.4609" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="177.6016" style="stroke:#000000;stroke-width:1.5;" width="501.7349" x="248.9551" y="373.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="263.9551" y="386.5278">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="113.9854" x="328.3979" y="385.6714">[Valid + Safe SQL]</text><g class="message" data-participant-1="Service" data-participant-2="DB"><polygon fill="#181818" points="662.2456,407.7266,672.2456,411.7266,662.2456,415.7266,666.2456,411.7266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="518.4302" x2="668.2456" y1="411.7266" y2="411.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.2241" x="525.4302" y="406.6606">Execute SQL (LLM)</text></g><g class="message" data-participant-1="Service" data-participant-2="Log"><polygon fill="#181818" points="709.064,436.8594,719.064,440.8594,709.064,444.8594,713.064,440.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="518.4302" x2="715.064" y1="440.8594" y2="440.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.98" x="525.4302" y="435.7935">status="llm" or "ollama"</text></g><g class="message" data-participant-1="Service" data-participant-2="API"><polygon fill="#181818" points="288.0293,465.9922,278.0293,469.9922,288.0293,473.9922,284.0293,469.9922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="282.0293" x2="517.4302" y1="469.9922" y2="469.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91.9204" x="294.0293" y="464.9263">Return results</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="248.9551" x2="750.6899" y1="478.9922" y2="478.9922"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="81.1465" x="253.9551" y="489.2026">[Unsafe SQL]</text><g class="message" data-participant-1="Service" data-participant-2="Log"><polygon fill="#181818" points="709.064,509.9297,719.064,513.9297,709.064,517.9297,713.064,513.9297" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="518.4302" x2="715.064" y1="513.9297" y2="513.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106.5898" x="525.4302" y="508.8638">status="unsafe"</text></g><g class="message" data-participant-1="Service" data-participant-2="API"><polygon fill="#181818" points="288.0293,539.0625,278.0293,543.0625,288.0293,547.0625,284.0293,543.0625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="282.0293" x2="517.4302" y1="543.0625" y2="543.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.4961" x="294.0293" y="537.9966">"&#128683; Unsafe query blocked"</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="238.9551" x2="858.1567" y1="559.0625" y2="559.0625"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="173.1318" x="243.9551" y="569.2729">[USE_LLM_FALLBACK=false]</text><g class="message" data-participant-1="Service" data-participant-2="Log"><polygon fill="#181818" points="709.064,590,719.064,594,709.064,598,713.064,594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="518.4302" x2="715.064" y1="594" y2="594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.4375" x="525.4302" y="588.9341">status="unsupported"</text></g><g class="message" data-participant-1="Service" data-participant-2="API"><polygon fill="#181818" points="288.0293,619.1328,278.0293,623.1328,288.0293,627.1328,284.0293,623.1328" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="282.0293" x2="517.4302" y1="623.1328" y2="623.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.1167" x="294.0293" y="618.0669">"&#10067; Query not supported"</text></g><!--SRC=[ZLDRJi905FtlAcxw1V51_3L1KnKIOp4ggObVv5AkC67QAVFmiGx_J8mBS5Ukm2LuPn1GGB59atRclEwPrWeh2RfOeD08oIbSEjAFq9Rg7cetIIU5BKZJ3hHHoZxcuteKOMwLXioG1ZIGHL46Epi7a5oSmZuqi1ADkxq6YiR4AnrEch7pK7upLgWoZZpG4xgaxqHEJAgqoicONc3KIZbzy5RIGWTjFW9H0egmBiZiFc8X8-1hfi5o9qUir7gWt5aUw3ATng__X34kLKC66elMcMRibU8Lp7IMAx9Ebw39E6aDr8mh2kHoja2hUyFnI1g2SmMXfyBd34e-TTPjzRYtNZj9qwFa-AnfjQEmknIRGSa0AyiLxSEGIj9egMScSjx3DfXyH0NMvtHlS8rI33XA5s_3kFFDZRMmOtqzUgKTAOiO-B1Z9IL_8l6lj7M5pS6XfgmqVoPTyNQ1iCao_dXzVfk9XxgWBrK-fi62IUKWMkHOFfXRvENeNtbSLIbjlqkl2VJ-ylJr4vNAmXB7H-7x4m00]--></g></svg>